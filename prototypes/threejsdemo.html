<html>
	<head>
		<title>CO2 Visualization Prototype</title>
		<style>
			body { margin: 0; font-family: sans-serif; background-color: #eeeeee;}
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<div id="header" align="center">
	    <h2 align="center" style="font-size:42;">3-D Visualization of Carbon Dioxide Emissions</h2>
	  </div>
		<div align="left">
			CO2 emissions, grams per mile
			<br />
			100
			<input id="co2slider" type="range" min="100" max="1200" value="400"/>
			1200
 		</div>
		<div id="viz" align="right" border="solid black 1px">
		<script src="../lib/three.min.js"></script>
		<script>
			var gramsToMeters = function(grams){
				var moles = grams/40;
				var liters = moles * 22.4;
				var m3 = liters/1000;
				var ds = Math.pow(m3,1/3);
				return ds;
			}
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

			var slider = document.getElementById("co2slider");
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth/2, window.innerHeight/2 );
			document.getElementById("viz").appendChild( renderer.domElement );
      renderer.setClearColor( 0xCCCCFF, 1);

			var geometry = new THREE.BoxGeometry( 1, 1, 1 );
			var spheregeo = new THREE.SphereGeometry(0.2159/2,18,18)
			var material = new THREE.MeshBasicMaterial( { color: 0xeeeeee, transparent:true, opacity:0.5} );
			var ballMaterial = new THREE.MeshBasicMaterial( {color: 0xdd0033 })
      var wireMaterial = new THREE.MeshBasicMaterial({color: 0xdddddd, wireframe:true });
			var ballMaterialWires = new THREE.MeshBasicMaterial({color: 0x000000, wireframe: true});
			var cube = new THREE.Mesh( geometry, material );
      var cubeWires = new THREE.Mesh( geometry, wireMaterial );
			var sphere = new THREE.Mesh( spheregeo, ballMaterial);
			var sphereWires = new THREE.Mesh( spheregeo, ballMaterialWires);

			var ballLabelGeo = new THREE.TextGeometry('Standard Kickball',{size: 12});
			var ballLabelMat = new THREE.MeshBasicMaterial( {color: 0xdd0033});
			var ballLabel = new THREE.Mesh( ballLabelGeo, ballLabelMat);

			scene.add(sphere);
			scene.add( sphereWires );
			scene.add( cube );
    	scene.add( cubeWires );
			scene.add(ballLabel);
			camera.position.z = 1.2;

      var render = function () {
				requestAnimationFrame( render );
				renderer.render(scene, camera);
			};
			var metersinit = gramsToMeters(slider.value);
			cube.scale.set(metersinit,metersinit,metersinit);
			cubeWires.scale.set(metersinit,metersinit,metersinit);
			var down = false;
    	    var sx = 0,
      		    sy = 0;
							ds = Math.pow(400,1/3);
    	window.onmousedown = function(ev) {
        down = true;
        sx = ev.clientX;
        sy = ev.clientY;
    	};
    	window.onmouseup = function() {
        	down = false;
    	};
    	document.getElementById("viz").onmousemove = function(ev) {
        	if (down) {
            	var dx = ev.clientX - sx;
            	var dy = ev.clientY - sy;
            	cube.rotation.y += dx * 0.01;
            	cube.rotation.x += dy * 0.01;
              cubeWires.rotation.y += dx * 0.01;
              cubeWires.rotation.x += dy * 0.01;
							sphere.rotation.y += dx * 0.01;
							sphere.rotation.x += dy * 0.01;
							sphereWires.rotation.y += dx * 0.01;
							sphereWires.rotation.x += dy * 0.01;
							sx += dx;
            	sy += dy;
        	}
    	};

			slider.oninput = function () {
				ds = gramsToMeters(slider.value);
				cube.scale.x = ds;
				cubeWires.scale.x = ds;
				cube.scale.y = ds;
				cubeWires.scale.y = ds;
				cube.scale.z = ds;
				cubeWires.scale.z = ds;
			};
			render();
		</script>
		<br />
		<br />
		The true volume of carbon produced per mile, compared to a standard kickball (I showed this to 5th graders). I used the ideal gas law to convert from grams to cubic meters.
    </div>
	</body>
</html>
